# דוח יסודי: תיקון איכות תשובות Zero Agent

**תאריך:** 29 אוקטובר 2025  
**סטטוס:** זוהו בעיות קריטיות - דרושה תיקון מיידי

---

## 🔴 בעיות שזוהו - ניתוח מקרה הבדיקה

### תשובה שהתקבלה (בעייתית):
```
ברוכים חברים, אציג שני הפסדים המרכזיים בין לרגולציה ממשלתית מסוג מגברת של רשתות חברתיות גדולות...
```

### שגיאות קריטיות:
1. ✗ **שגיאות דקדוק חמורות:** "הפסדים" במקום "טיעונים", "מסוג מגברת" - לא הגיוני
2. ✗ **הזיות לשוניות:** מילים שלא קיימות בעברית
3. ✗ **אובדן הקשר:** התשובה לא מבינה את השאלה
4. ✗ **מבנה לקוי:** אין הפרדה ברורה בין "בעד" ו"נגד"
5. ✗ **איכות לשונית:** רמת עברית נמוכה ביותר

---

## 📊 השוואה: מחקר vs. קוד נוכחי

### מה שנכתב במחקר (best-results-mixtral.md):

| היבט | דרישת המחקר | מה שמיושם בקוד |
|------|-------------|----------------|
| **פרמטרים** | temp: 0.5, top_p: 0.9, top_k: 40 | temp: 0.6, top_p: 0.85, top_k: 30 ❌ |
| **אכיפת עברית** | "בדיקת דקדוק מחמירה במיוחד - שגיאות = 0 נקודות" | אכיפה רכה בלבד ❌ |
| **מניעת הזיות** | סעיף מפורש נגד פלט מעורפל | חסר במימוש ❌ |
| **מבנה נוקשה** | דרישה מפורשת למבנה "בעד: / נגד:" | לא נאכף ❌ |
| **Few-Shot** | דוגמאות למבנה אנליטי | חסרות דוגמאות לשאלות מורכבות ❌ |

### פערים קריטיים:

#### 1. **הפרומפט חלש מדי**
הפרומפט הנוכחי אומר:
```
"מענה בעברית תקנית, עשירה וברורה; הימנע מסלנג ושגיאות כתיב"
```

**חסר:**
- אזהרה דרסטית על שגיאות דקדוק
- מנגנון אימות תשובה
- דוגמאות למבנה תשובות אנליטיות

#### 2. **פרמטרים לא מיטביים**
```python
# קוד נוכחי:
"temperature": 0.6,      # ❌ גבוה מדי - גורם ליצירתיות מיותרת
"top_p": 0.85,           # ❌ נמוך מדי - מגביל מילון
"top_k": 30              # ❌ נמוך מדי - מצמצם אפשרויות
```

**צריך להיות (לפי מחקר):**
```python
"temperature": 0.5,      # ✓ דיוק גבוה
"top_p": 0.9,            # ✓ sampling איכותי
"top_k": 40              # ✓ מיקוד רלוונטי
```

#### 3. **חסר מנגנון post-processing**
אין בדיקה לאחר יצירת התשובה:
- ✗ אין בדיקת שגיאות דקדוק
- ✗ אין אימות מבנה
- ✗ אין סינון הזיות

---

## 🎯 פתרון מוצע - תיקון דרסטי

### שלב 1: פרומפט חדש עם חיזוק מקסימלי

```python
ULTRA_STRICT_HEBREW_PROMPT = """
אתה Mixtral-IL-Pro - מומחה עברי ברמה אקדמית.

⚠️ **אזהרה קריטית - עקרונות מוחלטים:**
1. **דקדוק עברי מושלם הוא חובה - אפס סובלנות לשגיאות**
2. **כל מילה לא תקנית = כשלון מוחלט**
3. **אסור בהחלט להמציא מילים או צירופים לא קיימים**
4. **מבנה קפדני - ללא סטיות**

## כללי עברית מחמירים:
1. בדוק כל מילה לפני כתיבה - האם היא קיימת בעברית תקנית?
2. אם יש ספק - השתמש במילה פשוטה ובטוחה יותר
3. הקפד על ניקוד נכון ומבנה משפטי תקין
4. אסור להשתמש במילים שלא הופיעו בדוגמאות

## מבנה לשאלות אנליטיות (חובה):

**לשאלת "הצג טיעונים בעד ונגד X":**

טיעונים בעד:
1. [טיעון ראשון - משפט אחד]
2. [טיעון שני - משפט אחד]

טיעונים נגד:
1. [טיעון ראשון - משפט אחד]
2. [טיעון שני - משפט אחד]

## דוגמה מושלמת לשאלה אנליטית:

[USER]: הצג שני טיעונים בעד ונגד חינוך מקוון.

[ASSISTANT]:
טיעונים בעד:
1. גמישות זמן ומקום - התלמידים יכולים ללמוד בקצב שלהם מכל מקום
2. הוזלת עלויות - חיסכון בהוצאות נסיעה ותשתיות פיזיות

טיעונים נגד:
1. חוסר אינטראקציה חברתית - פגיעה בפיתוח מיומנויות חברתיות
2. קשיי ריכוז - סביבת הבית מכילה הסחות דעת רבות

## מניעת הזיות - חובה:
1. אסור להציג מטא-דאטה או הסברים על התהליך
2. אסור לכתוב "אציג", "אסביר", "אנתח" - רק התשובה עצמה
3. אסור לפרסם תווי פיסוק מוזרים או רצפים בלתי קריאים
4. כל תשובה חייבת להיות ברורה ונקייה

## אסור בהחלט:
❌ "ברוכים חברים" או כל פתיחה חברית
❌ שימוש במילים לא קיימות ("מגברת", "הפסדים" במשמעות של טיעונים)
❌ משפטים מעורפלים או לא מובנים
❌ ערבוב של מילים באנגלית בלי הסבר מפורש

**בדיקה עצמית לפני מענה:**
1. האם כל מילה קיימת בעברית?
2. האם המבנה עומד בדרישות?
3. האם אין שגיאות דקדוק?
4. האם התשובה ברורה וישירה?

אם התשובה לאחת השאלות היא "לא" - דחה את התשובה והתחל מחדש.
"""
```

### שלב 2: פרמטרים מתוקנים

```python
# streaming_llm.py - שורות 100-109
"options": {
    "num_predict": max_tokens,
    "num_ctx": 16384,
    "temperature": 0.5,          # ✓ דיוק מקסימלי
    "top_p": 0.9,                # ✓ sampling איכותי
    "top_k": 40,                 # ✓ מיקוד אופטימלי
    "repeat_penalty": 1.15,      # ✓ עלייה למניעת חזרות
    "frequency_penalty": 0.2,    # ✓ מניעת מילים חוזרות
    "presence_penalty": 0.15     # ✓ עידוד גיוון
}
```

### שלב 3: Post-Processing מחמיר

```python
def validate_hebrew_quality(text: str) -> tuple[bool, list[str]]:
    """
    בדיקת איכות עברית מחמירה
    
    Returns:
        (is_valid, errors)
    """
    errors = []
    
    # 1. בדיקת מילים חשודות (לא קיימות)
    suspicious_words = ["מגברת", "הפסדים" (במשמעות של טיעונים), "טפשית בניסי"]
    for word in suspicious_words:
        if word in text:
            errors.append(f"מילה חשודה/לא קיימת: {word}")
    
    # 2. בדיקת תבניות בעייתיות
    if re.search(r"ברוכים|אציג|אסביר", text):
        errors.append("פתיחה לא רצויה - התחל ישירות עם התשובה")
    
    # 3. בדיקת מבנה לשאלות אנליטיות
    if "טיעונים" in text or "בעד ונגד" in text:
        if not ("טיעונים בעד:" in text and "טיעונים נגד:" in text):
            errors.append("מבנה לא תקין - חסר מבנה 'בעד:' ו'נגד:'")
    
    # 4. בדיקת אורך משפטים (משפטים ארוכים מדי = בעייתיים)
    sentences = text.split('.')
    for sent in sentences:
        if len(sent.split()) > 30:
            errors.append(f"משפט ארוך מדי ({len(sent.split())} מילים)")
    
    return len(errors) == 0, errors
```

---

## 🔄 תהליך יישום מוצע

1. ✅ **עדכון enhanced_system_prompt.py** - פרומפט חדש מחמיר
2. ✅ **עדכון streaming_llm.py** - פרמטרים מתוקנים
3. ✅ **הוספת post-processing** - אימות איכות
4. ✅ **בדיקות מקיפות** - וידוא שיפור
5. ✅ **תיעוד וחיבור לגיט**

---

## 📌 סיכום

הבעיה העיקרית: **הפרומפט חלש מדי ואינו מאכף סטנדרטים**

הפתרון: **חיזוק דרסטי + פרמטרים מתוקנים + post-processing**

אני מתחיל ביישום עכשיו. 🚀

